<% include header %>
<div class="markdown">
  <h1>
    <a href="/package/<%= project.name %>/"><%= project.name %></a>
    <img class="badge" src="/badge/<%= project.name %>">
  </h1>
  <aside class="aside-right">
    <% if (doclink) { %>
    <a href="<%= doclink %>" title="Documentation hosted in spmjs">
      <i class="iconfont iconfont-doclink">&#xf012b;</i>
    </a>
    <% } %>
    <% if (project.repository && project.repository.url) { %>
    <a href="<%= project.repository.url %>" class="github-stars" title="github star count">
      <i class="iconfont iconfont-star">&#xf0290;</i>
      <span class="github-star-count"></span>
    </a>
    <% } %>
  </aside>
  <hr>
  <p><%= project.description %></p>
  <pre>spm install <%= project.name %></pre>
  <p>
    Latest version: <strong><%= project.latest.version %></strong>
    <span>~ <%= project.latest.tag %></span>
  </p>
  <table class="meta">
    <tr>
      <th>Versions</th>
      <td>
      <% project.versions.forEach(function(v) { %>
        <a href="/package/<%= project.name %>/<%= v %>"><%= v %></a>
      <% }) %>
      </td>
    </tr>
    <tr>
      <th>Updated</th>
      <td><%= project.updated_at %></td>
    </tr>
    <% if (project.owners) { %>
    <tr>
      <th>Owner</th>
      <td>
      <% project.owners.forEach(function(owner) { %>
        <% if (anonymous) { %>
          <%= owner %>
        <% } else { %>
          <a href="/account/<%= owner %>"><%= owner %></a>
        <% } %>
      <% }) %>
      </td>
    </tr>
    <% } %>
    <% if (project.keywords) { %>
    <tr>
      <th>Keywords</th>
      <td><%= project.keywords %></td>
    </tr>
    <% } %>
    <% if (project.homepage) { %>
    <tr>
      <th>Homepage</th>
      <td><a href="<%= project.homepage %>"><%= project.homepage %></a></td>
    </tr>
    <% } %>
    <% if (project.repository && project.repository.url) { %>
    <tr>
      <th>Repository</th>
      <td><a href="<%= project.repository.url %>"><%= project.repository.url %></a></td>
    </tr>
    <% } %>
    <% if (project.latest.dependencies && project.latest.dependencies.length > 0) { %>
    <tr>
      <th>Dependencies</th>
      <td><%= project.latest.dependencies.join(', ') %></td>
    </tr>
    <% } %>
    <% if (project.latest.dependents && project.latest.dependents.length > 0) { %>
    <tr>
      <th>Dependents</th>
      <td><%= project.latest.dependents.join(', ') %></td>
    </tr>
    <% } %>
    <% if (project.latest.spm.main) { %>
    <tr>
      <th>Main</th>
      <td><%= project.latest.spm.main %></td>
    </tr>
    <% } %>
  </table>
</div>
<div class="markdown">
<%- project.latest.readme %>
</div>

<script>
seajs.use('$', function($) {
  $('.github-stars').each(function(i, item) {
    item = $(item);
    var url = item.attr('href');
    var match = url.match('github\.com[/:](.*)(\.git)$');
    if (match) {
      var repo = match[1];
      $.ajax({
        url: 'https://api.github.com/repos/' + repo,
        dataType: 'jsonp',
        success: function(data) {
          var count = data.data.stargazers_count;
          item.find('.github-star-count').html(count);
          item.show();
        }
      });
    }
  });
});

</script>
<% include footer %>
